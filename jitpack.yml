jdk:
  - openjdk17

before_install:
  - echo "JITPACK_TAG:" ${JITPACK_TAG:-empty}
  - echo "JITPACK_GIT_REF:" ${JITPACK_GIT_REF:-empty}
  - >
    TAG="${JITPACK_TAG:-${JITPACK_GIT_REF:-}}" &&
    if [ -z "$TAG" ]; then
      echo "No tag from JitPack env vars, trying git describe...";
      TAG=$(git describe --tags --exact-match 2>/dev/null || git describe --tags 2>/dev/null || echo "");
      echo "Tag from git describe: $TAG";
    fi &&
    if [[ "$TAG" == android-* ]]; then
      echo "Building Android SDK with tag: $TAG";
    else
      echo "Error: Not an Android release tag (expected android-*, got '$TAG')";
      exit 1;
    fi

install:
  - cd sdk/android
  - echo "Checking Gradle Wrapper..."
  - ls -la gradle/wrapper/ || echo "wrapper directory not found"
  - file gradle/wrapper/gradle-wrapper.jar || echo "jar file check failed"
  - |
    if [ ! -f gradle/wrapper/gradle-wrapper.jar ] || [ ! -s gradle/wrapper/gradle-wrapper.jar ]; then
      echo "gradle-wrapper.jar missing or empty, downloading from Gradle 8.2 distribution..."
      mkdir -p gradle/wrapper
      curl -L -o gradle/wrapper/gradle-wrapper.jar https://raw.githubusercontent.com/gradle/gradle/v8.2.0/gradle/wrapper/gradle-wrapper.jar
    fi
  - chmod +x gradlew
  - ./gradlew clean :dreaction:build :dreaction:publishToMavenLocal -x test
